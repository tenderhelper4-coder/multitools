<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Multi-Material Price Escalation Calculator</title>
<style>
body { font-family: Arial, sans-serif; background: #f4f4f9; margin:0; padding:0; }
.container { max-width: 1000px; margin: 30px auto; background: #fff; padding: 20px 30px; border-radius: 10px; box-shadow: 0 5px 15px rgba(0,0,0,0.1);}
h1 { text-align:center; color:#333; }
p.description { text-align:center; font-size:16px; color:#555; }
table { width:100%; border-collapse: collapse; margin-top: 20px; }
th, td { border:1px solid #ccc; padding:8px; text-align:center; }
th { background:#007bff; color:#fff; }
input[type="number"], input[type="date"] { width: 100%; padding:5px; border:1px solid #ccc; border-radius:4px; }
button { margin-top: 15px; padding:10px 20px; border:none; border-radius:5px; cursor:pointer; font-size:15px; }
button:hover { opacity:0.9; }
.addBtn { background:#28a745; color:#fff; }
.calcBtn { background:#007bff; color:#fff; }
.exportBtn { background:#ffc107; color:#000; margin-left:5px; }
.printBtn { background:#17a2b8; color:#fff; margin-left:5px; }
.result { margin-top:20px; background:#e2f0d9; padding:15px; border-radius:5px; font-weight:bold; color:#2a6f2a; }
.faq { margin-top:40px; background:#f9f9f9; padding:20px; border-radius:10px; }
.faq h3 { margin-top:0; }
@media print { button { display:none; } }
</style>
</head>
<body>
<div class="container">
<h1>Multi-Material Price Escalation Calculator</h1>
<p class="description">Calculate escalated prices for multiple materials with different escalation rates as per contract. Export results to Excel or JSON.</p>

<table id="materialsTable">
<thead>
<tr>
<th>Material Name</th>
<th>Base Price/unit (₹)</th>
<th>Quantity</th>
<th>Contract Start Date</th>
<th>Current Date</th>
<th>Escalation % per Year</th>
<th>Escalated Price/unit (₹)</th>
<th>Total Escalated Cost (₹)</th>
<th>Action</th>
</tr>
</thead>
<tbody>
<tr>
<td><input type="text" placeholder="Material 1"></td>
<td><input type="number" min="0" step="0.01"></td>
<td><input type="number" min="0" step="0.01"></td>
<td><input type="date"></td>
<td><input type="date"></td>
<td><input type="number" min="0" step="0.01"></td>
<td>0</td>
<td>0</td>
<td><button onclick="removeRow(this)">Delete</button></td>
</tr>
</tbody>
</table>

<button class="addBtn" onclick="addRow()">+ Add Material</button>
<button class="calcBtn" onclick="calculateAll()">Calculate Escalation</button>
<button class="exportBtn" onclick="exportCSV()">Export CSV</button>
<button class="exportBtn" onclick="exportJSON()">Export JSON</button>
<button class="printBtn" onclick="window.print()">Print / PDF</button>

<div class="result" id="totalResult" style="display:none;"></div>

<div class="faq">
<h3>FAQ</h3>
<p><strong>Q1:</strong> How is escalation calculated?</p>
<p><em>A1:</em> Escalation per material is calculated as: <br>
<code>Escalated Price/unit = Base Price × (1 + Escalation%/100) ^ Years</code></p>
<p><strong>Q2:</strong> Can I calculate multiple materials at once?</p>
<p><em>A2:</em> Yes, add multiple rows for each material and click "Calculate Escalation".</p>
<p><strong>Q3:</strong> Can I export data?</p>
<p><em>A3:</em> Yes, use "Export CSV" or "Export JSON" buttons. You can also print or save as PDF.</p>
</div>
</div>

<script>
function addRow() {
    const table = document.getElementById('materialsTable').getElementsByTagName('tbody')[0];
    const row = table.insertRow();
    row.innerHTML = `
    <td><input type="text" placeholder="Material"></td>
    <td><input type="number" min="0" step="0.01"></td>
    <td><input type="number" min="0" step="0.01"></td>
    <td><input type="date"></td>
    <td><input type="date"></td>
    <td><input type="number" min="0" step="0.01"></td>
    <td>0</td>
    <td>0</td>
    <td><button onclick="removeRow(this)">Delete</button></td>
    `;
}

function removeRow(btn) {
    const row = btn.parentNode.parentNode;
    row.parentNode.removeChild(row);
}

function calculateAll() {
    const table = document.getElementById('materialsTable').getElementsByTagName('tbody')[0];
    let totalCost = 0;
    for(let row of table.rows){
        const basePrice = parseFloat(row.cells[1].children[0].value) || 0;
        const qty = parseFloat(row.cells[2].children[0].value) || 0;
        const startDate = new Date(row.cells[3].children[0].value);
        const currentDate = new Date(row.cells[4].children[0].value);
        const escPercent = parseFloat(row.cells[5].children[0].value) || 0;

        if(currentDate < startDate) {
            alert("Current date cannot be before contract start date for a material.");
            return;
        }

        const diffTime = Math.abs(currentDate - startDate);
        const years = diffTime / (1000*60*60*24*365);

        const escalatedUnit = basePrice * Math.pow(1 + escPercent/100, years);
        const totalEscalated = escalatedUnit * qty;

        row.cells[6].innerText = escalatedUnit.toFixed(2);
        row.cells[7].innerText = totalEscalated.toFixed(2);

        totalCost += totalEscalated;
    }
    const resultDiv = document.getElementById('totalResult');
    resultDiv.style.display = 'block';
    resultDiv.innerHTML = `Total Escalated Cost of All Materials: ₹${totalCost.toFixed(2)}`;
}

// Export CSV
function exportCSV() {
    const table = document.getElementById('materialsTable');
    let csv = [];
    for(let row of table.rows){
        let rowData = [];
        for(let cell of row.cells){
            if(cell.children[0]){
                rowData.push(cell.children[0].value);
            } else {
                rowData.push(cell.innerText);
            }
        }
        csv.push(rowData.join(","));
    }
    const csvString = csv.join("\n");
    const blob = new Blob([csvString], {type: "text/csv"});
    const url = URL.createObjectURL(blob);
    const a = document.createElement("a");
    a.href = url; a.download = "material_escalation.csv"; a.click();
}

// Export JSON
function exportJSON() {
    const table = document.getElementById('materialsTable').getElementsByTagName('tbody')[0];
    let data = [];
    for(let row of table.rows){
        const item = {
            material: row.cells[0].children[0].value,
            basePrice: parseFloat(row.cells[1].children[0].value) || 0,
            quantity: parseFloat(row.cells[2].children[0].value) || 0,
            startDate: row.cells[3].children[0].value,
            currentDate: row.cells[4].children[0].value,
            escalationPercent: parseFloat(row.cells[5].children[0].value) || 0,
            escalatedPricePerUnit: parseFloat(row.cells[6].innerText) || 0,
            totalEscalatedCost: parseFloat(row.cells[7].innerText) || 0
        };
        data.push(item);
    }
    const blob = new Blob([JSON.stringify(data, null, 2)], {type: "application/json"});
    const url = URL.createObjectURL(blob);
    const a = document.createElement("a");
    a.href = url; a.download = "material_escalation.json"; a.click();
}
</script>
</body>
</html>
